# 店長多門市指派功能

## 功能概述

此功能允許將一個店長同時指派到多間門市，方便管理跨店業務。

## 主要變更

### 1. 前端介面改進

- **多選門市列表**：使用複選框（checkbox）取代原本的下拉選單，可同時選擇多個門市
- **已選門市提示**：顯示已選擇的門市數量
- **分組顯示**：在指派列表中，同一店長管理的所有門市會合併顯示
- **個別移除**：可以移除店長對特定門市的指派，或一次移除所有指派

### 2. API 更新

#### POST `/api/store-managers/assign`
- **輸入**：
  - `userId`: 用戶ID
  - `storeIds`: 門市ID陣列（必須至少包含一個）
- **功能**：批量指派店長到多個門市
- **行為**：會先移除該用戶的所有現有店長指派，然後新增選擇的門市指派

#### DELETE `/api/store-managers/assign`
- **輸入**：
  - `userId`: 用戶ID
  - `storeId`: （可選）特定門市ID
- **功能**：移除店長指派
  - 如果提供 `storeId`：只移除該門市的指派
  - 如果不提供 `storeId`：移除該用戶的所有店長指派

### 3. 資料庫結構

資料庫表 `store_managers` 已經支援一個用戶管理多個門市：
- `UNIQUE(store_id, user_id, role_type)` 約束確保每個用戶-門市-角色組合是唯一的
- 一個用戶可以有多條記錄，分別對應不同的門市

## 使用方式

1. **指派店長到多間門市**：
   - 搜尋並選擇店長
   - 在門市列表中勾選要指派的門市（可複選）
   - 點擊「儲存指派」按鈕

2. **編輯店長的門市指派**：
   - 搜尋並選擇已有指派的店長
   - 系統會自動載入該店長目前管理的門市
   - 勾選或取消勾選門市來調整指派
   - 點擊「儲存指派」更新

3. **移除指派**：
   - **移除特定門市**：在右側列表中，點擊門市旁邊的 ❌ 按鈕
   - **移除所有門市**：在右側列表中，點擊店長名稱旁邊的 ❌ 按鈕

## 注意事項

- 一個門市可以被指派給多個店長（如果需要主副店長的概念）
- 儲存時會先清除該店長的所有現有指派，再新增選擇的門市
- 系統會在介面上提示哪些門市已經有其他店長

## 技術細節

### 修改的檔案

1. **前端頁面**：`app/admin/store-managers/page.tsx`
   - 改用 `selectedStoreIds` 陣列取代 `selectedStoreId` 字串
   - 新增 `handleToggleStore` 函數處理多選
   - 更新 UI 為複選框列表
   - 優化右側列表，按店長分組顯示

2. **API 路由**：`app/api/store-managers/assign/route.ts`
   - POST 方法改為接收 `storeIds` 陣列
   - 新增 DELETE 方法支援移除單一或全部指派
   - 使用批量插入提升效能

3. **類型定義**：更新 `StoreManagerAssignment` 介面

## 測試建議

1. 測試指派一個店長到多間門市
2. 測試編輯現有店長的門市指派（新增/移除門市）
3. 測試移除特定門市的指派
4. 測試移除店長的所有指派
5. 確認右側列表正確顯示各店長管理的門市
6. 確認多個店長可以管理同一門市（如果這是預期行為）
